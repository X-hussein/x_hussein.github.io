<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Page 1 - Send to B</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body style="font-family:sans-serif; padding:2rem; max-width:600px; margin:auto;">
  <h2>✉️ Send Message to Page 2</h2>
  <textarea id="sendBox" placeholder="Write your message..." style="width:100%; height:100px;"></textarea>
  <button onclick="sendMessage()" style="margin-top:10px;">Send</button>
  <p id="status" style="color: green;"></p>

  <hr />

  <h2>📥 Message from Page 2</h2>
  <div id="receivedMessage">Loading...</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { getFirestore, doc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAh_wT6Gen8-gLNnDOmwIixOthwSs7PdhM",
      authDomain: "nfc-message-app.firebaseapp.com",
      databaseURL: "https://nfc-message-app-default-rtdb.firebaseio.com",
      projectId: "nfc-message-app",
      storageBucket: "nfc-message-app.firebasestorage.app",
      messagingSenderId: "770349934206",
      appId: "1:770349934206:web:4434e3f1b00893d1c09a2f",
      measurementId: "G-87YV2RWQVR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const docRef = doc(db, "chat", "sharedMessage");

    async function sendMessage() {
      const msg = document.getElementById("sendBox").value.trim();
      if (!msg) return;
      try {
        await updateDoc(docRef, { messageFromA: msg });
        document.getElementById("status").innerText = "✅ Message sent!";
      } catch (error) {
        console.error("Error:", error);
        document.getElementById("status").innerText = "❌ Failed to send.";
      }
    }

    // Live update for messageFromB
    onSnapshot(docRef, (docSnap) => {
      const data = docSnap.data();
      document.getElementById("receivedMessage").innerText = data.messageFromB || "(No reply yet)";
    });
  </script>
</body>
</html>
